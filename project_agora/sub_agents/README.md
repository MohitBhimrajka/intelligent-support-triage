# Sub-Agents Directory

This directory contains the specialized "worker" agents managed by the main `orchestrator_agent`. Each sub-agent is a modular component with a single, well-defined responsibility in the developer support workflow. This separation of concerns is a core design principle of the Project Agora framework.

### The Orchestration Flow

The central `orchestrator_agent` directs the workflow based on its state machine prompt. The typical flow for a technical request is as follows:

`User Request` → `ticket_analysis_agent` → `[knowledge_retrieval_agent & db_retrieval_agent (in parallel)]` → **(User Confirms)** → `[code_generator_agent OR problem_solver_agent]` → `code_reviewer_agent (if code)` → `Final Response`

The logic for this entire sequence is defined in the orchestrator's prompt: `project_agora/prompts.py`.

---

## The AI Team Roster

### 1. `ticket_analysis_agent` (The Analyst)
*   **Responsibility:** Performs initial triage on the user's query, which can include text and links to files in Google Cloud Storage.
*   **Input:** The developer's verbatim request.
*   **Output:** A structured JSON object containing `urgency`, `category`, `sentiment`, and `summary`.
*   **Key Technology:** `gemini-2.5-pro`, Multi-modal understanding, `read_user_file` tool.

### 2. `knowledge_retrieval_agent` (The Librarian)
*   **Responsibility:** Searches the official ADK documentation for relevant guides, APIs, and best practices.
*   **Input:** The summary of the issue from the ticket analysis.
*   **Output:** A string containing the most relevant snippets from the documentation.
*   **Key Technology:** ADK's built-in `VertexAiRagRetrieval` tool connected to a Vertex AI RAG Corpus.

### 3. `db_retrieval_agent` (The Veteran)
*   **Responsibility:** Searches for historical solutions to similar problems in a BigQuery database.
*   **Input:** The summary of the issue from the ticket analysis.
*   **Output:** A string representation of similar past tickets found via vector search.
*   **Key Technology:** Custom tool executing a `COSINE_DISTANCE` vector search in Google BigQuery.

### 4. `problem_solver_agent` (The Synthesizer)
*   **Responsibility:** The final synthesis agent for providing text-based solutions to troubleshooting, configuration, and conceptual questions.
*   **Input:** A comprehensive context block with the original request, analysis, and all retrieved data.
*   **Output:** A professional, formatted Markdown response for the end-user.
*   **Key Technology:** `gemini-2.5-pro` with a detailed persona and response-formatting prompt.

### 5. `code_generator_agent` (The Engineer)
*   **Responsibility:** The primary agent for creating code. It first designs a plan and a visual architecture diagram, then generates complete, multi-file code upon user approval. It operates in two stages: first, it proposes a plan and a Mermaid diagram for user approval, and only then does it generate the full code.
*   **Input:** A comprehensive context block, and a second-turn confirmation from the user.
*   **Output:** A JSON plan with Mermaid syntax, and later, a multi-file ADK project as a string.
*   **Key Technology:** `gemini-2.5-pro`, `generate_diagram_from_mermaid` tool, and a formal style guide.

### 6. `code_reviewer_agent` (The QA Lead)
*   **Responsibility:** Acts as an automated quality assurance gate. It analyzes code from the code_generator_agent against a formal style guide, ensuring correctness and best practices. It can approve the code or reject it and provide corrected code.
*   **Input:** The complete, multi-file code generated by the `code_generator_agent`.
*   **Output:** A JSON object indicating approval or rejection, and if rejected, provides the corrected code.
*   **Key Technology:** `gemini-2.5-pro` with a strict, checklist-based prompt that enforces a formal style guide.