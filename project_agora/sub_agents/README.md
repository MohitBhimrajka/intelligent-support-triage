# Sub-Agents Directory

This directory contains the specialized "worker" agents managed by the main `orchestrator_agent`. Each sub-agent is a modular component with a single, well-defined responsibility in the developer support workflow. This separation of concerns is a core design principle of the Project Agora framework.

### The Orchestration Flow

The central `orchestrator_agent` directs the workflow based on its state machine prompt. The typical flow for a technical request is as follows:

`User Request` → `ticket_analysis_agent` → `[knowledge_retrieval_agent & db_retrieval_agent (in parallel)]` → **(User Confirms)** → `[code_generator_agent OR problem_solver_agent]` → `code_reviewer_agent (if code)` → `Final Response`

The logic for this entire sequence is defined in the orchestrator's prompt: `project_agora/prompts.py`.

---

## The Agent Hierarchy

### 1. `ticket_analysis_agent` (The Triage Agent)
*   **Responsibility:** Performs initial request analysis and classification. It uses a custom `read_user_file` tool to process contextual data from Google Cloud Storage URIs (`gs://...`).
*   **Input:** The developer's verbatim request.
*   **Output:** A structured JSON object containing `urgency`, `category`, `sentiment`, and `summary`.
*   **Key Technology:** `gemini-2.5-pro`, Multi-modal understanding, `read_user_file` tool.

### 2. `knowledge_retrieval_agent` (The RAG Agent)
*   **Responsibility:** Executes queries against a knowledge base using the ADK's built-in `VertexAiRagRetrieval` tool.
*   **Input:** The summary of the issue from the ticket analysis.
*   **Output:** A string containing the most relevant snippets from the documentation.
*   **Key Technology:** ADK's built-in `VertexAiRagRetrieval` tool connected to a Vertex AI RAG Corpus.

### 3. `db_retrieval_agent` (The Vector Search Agent)
*   **Responsibility:** Recalls historical solutions by executing a `COSINE_DISTANCE` vector search against a BigQuery table.
*   **Input:** The summary of the issue from the ticket analysis.
*   **Output:** A string representation of similar past tickets found via vector search.
*   **Key Technology:** Custom tool executing a `COSINE_DISTANCE` vector search in Google BigQuery.

### 4. `problem_solver_agent` (The Synthesis Agent)
*   **Responsibility:** A stateless `LlmAgent` that synthesizes context from all prior steps to formulate step-by-step text solutions for non-code issues.
*   **Input:** A comprehensive context block with the original request, analysis, and all retrieved data.
*   **Output:** A professional, formatted Markdown response for the end-user.
*   **Key Technology:** `gemini-2.5-pro` with a detailed persona and response-formatting prompt.

### 5. `code_generator_agent` (The Code Generation Agent)
*   **Responsibility:** Designs a plan with a Mermaid diagram for user approval, then generates complete, multi-file ADK agent code based on a strict style guide.
*   **Input:** A comprehensive context block, and a second-turn confirmation from the user.
*   **Output:** A JSON plan with Mermaid syntax, and later, a multi-file ADK project as a string.
*   **Key Technology:** `gemini-2.5-pro`, `generate_diagram_from_mermaid` tool, and a formal style guide.

### 6. `code_reviewer_agent` (The QA Agent)
*   **Responsibility:** A dedicated agent that programmatically reviews generated code against a formal style guide to ensure correctness and adherence to best practices.
*   **Input:** The complete, multi-file code generated by the `code_generator_agent`.
*   **Output:** A JSON object indicating approval or rejection, and if rejected, provides the corrected code.
*   **Key Technology:** `gemini-2.5-pro` with a strict, checklist-based prompt that enforces a formal style guide.